---
type: mechanic
system: insertion
tags: [lore_integrated, matchmaking, spawn_logic, sarcophagus, squad_mechanics]
related_files:
  - "[[Lang_RU/10_Mechanics/05_World_Systems/02_Generation/12_World_Regeneration|World_Regeneration]]"
  - "[[Lang_RU/10_Mechanics/01_Player_Core/02_Shell_Specification|Shell_Specification]]"
---

# Логика Входа: Протокол "Саркофаг"

## 1. Мета-Концепция: Транзит
**Лор:** Оболочки доставляются в Аномалию физически через древнюю сеть подземных Пневмо-Магистралей. "Бригадир" (Игрок) подключается к телу (Моргает) только в момент открытия крышки на месте.
**Техника:** Асинхронное подключение к уже идущей сессии.

---

## 2. Поиск Канала (Matchmaking)
> *«Диспетчер ищет стабильную частоту в Шторме...»*

**System Logic:**
При нажатии "Deploy" система фильтрует список активных серверов:
1.  **Ping Limit:** < 100ms (Стабильность нейро-линка).
2.  **Storm Safety:** Время жизни сервера < 05:45 (Не отправлять Саркофаг за 15 мин до коллапса магистралей).
3.  **Throughput:** Кол-во игроков < `Max_Capacity`.

---

## 3. Выбор Точки Прорыва (Spawn Scorer)
> *«Навигатор ищет точку, где земля достаточно мягкая для пробития, и где нет свидетелей.»*

В игре нет случайного спавна. Каждая точка входа (люк, пол подвала, трещина в асфальте) оценивается перед запуском.

**Алгоритм Безопасности ($S$):**
Для каждой точки $P$ рассчитывается вес:
$$S = (Dist_{Enemy} * W_{Safe}) + (Dist_{Loot} * W_{Greed}) + (LineOfSight_{Check} * W_{Stealth})$$

### Критерии Отмены (Hard Veto)
Система **запрещает** высадку в точку, если:
1.  **Proximity Breach:** В радиусе **80м** есть враг (Саркофаг слишком громкий, его услышат).
2.  **Combat Zone:** Точка находится в зоне активного боя AI (NavMesh Alert).
3.  **Hot Pipe:** Точка использовалась < 3 минут назад (Труба еще горячая/Перезарядка).

---

## 4. Групповая Высадка (Squad Deployment)
> *«Синхронизированный залп. Три капсулы пробивают пол в одном зале. Нейро-линки сплетены.»*

Если игроки в Пати, алгоритм меняется:
1.  **Cluster Search:** Система ищет только те точки спавна, которые имеют тег `[Size:: Large]` или `[Cluster_ID]`.
    * *Пример:* Три соседних канализационных люка на одном перекрестке.
2.  **Simultaneous Launch:** Все клиенты группы получают команду на вход одновременно.
3.  **Link Protection:** Если для одного члена группы точка небезопасна — она отменяется для всей группы.

---

## 5. Машина Состояний: Прибытие (Arrival State Machine)

| State | Лорное Описание | Техническая Реализация |
| :--- | :--- | :--- |
| **Connecting** | *«Загрузка нейро-буфера...»* | Загрузка ассетов уровня. |
| **Transit** | *«Саркофаг несется по трубам. Удары, скрежет.»* | Loading Screen (анимированный, вид из глаз или от 3-го лица на капсулу). |
| **Breach** | *«Удар! Капсула пробивает поверхность. Пар и пыль.»* | Спавн объекта `Sarcophagus_BP` с анимацией `Impact`. Включается Collider. |
| **The Blink** | *«Синхронизация. Глаза открываются.»* | Передача управления (Possess Pawn). Включение HUD. |
| **Wake Up** | *«Оболочку тошнит после транзита. Продувка систем.»* | Анимация выхода (3 сек). Статус **Invulnerable**. |

### Anti-Camp Protection
Если игрок нажимает "Огонь" во время фазы `Wake Up`:
* **Лор:** Адреналин сбивает калибровку щитов.
* **Код:** Неуязвимость снимается мгновенно.