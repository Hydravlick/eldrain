---
type: tech_spec
system: generation_algo
tags: [math, vectors, snapping]
---

# Система Сокетов (Socket System)

## 1. Структура Данных
Для бесшовности используется система "Папа-Мама" с контекстной проверкой. Каждый стык (на границе префаба или дороги) содержит мета-данные:

1.  **Position (Vector3):** Мировые координаты стыка.
2.  **Tangent (Vector3):** Вектор направления ("куда смотрит дорога").
3.  **Profile ID (String):** Тип стыка (например, `Road_Main_4m`, `Alley_2m`, `Sewage_1m`).

## 2. Правило "Защелки" (Snap Rule)
При генерации Сектора Б рядом с существующим Сектором А валидация проходит только при выполнении всех условий:
1.  **Profile Match:** `ID` сокетов совпадают.
2.  **Position Match:** Координаты совпадают (с допуском `epsilon`).
3.  **Tangent Inversion:** Вектор направления нового сокета строго **противоположен** существующему (`Tangent A == -Tangent B`).