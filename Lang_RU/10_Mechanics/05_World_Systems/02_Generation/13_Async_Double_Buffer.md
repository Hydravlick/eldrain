---
type: architecture
system: server_core
tags: [optimization, threading, networking]
---

# Асинхронная Архитектура Мира

## 1. Двойная Буферизация (World A / World B)
На сервере существуют два параллельных контекста:
* **Мир А (Active):** Текущая игровая сцена. Игроки стреляют и лутаются.
* **Мир Б (Shadow):** Теневая сцена, где идет процедурная генерация следующего цикла.

## 2. Time-Slicing (Нарезка по времени)
Чтобы не уронить серверный Tickrate, инстанцирование объектов (превращение данных в GameObject) происходит в главном потоке порционно.
* *Лимит:* Не более **X мс** (например, 2мс) на генерацию в одном кадре.
* *Процесс:* Корутина строит 5 стен, делает `yield`, ждет следующий кадр.

## 3. Ленивый Лут (Lazy Load)
Лут в контейнерах не существует физически до момента взаимодействия.
* При генерации создаются только легкие `LootSpawners`.
* Предмет (`Item`) генерируется и сериализуется только когда игрок открывает ящик.

## 4. Синхронизация
* **Seeds:** Передача клиенту `Seed` генерации для локального воспроизведения геометрии (требует детерминизма).
* **Chunks:** Постепенная подгрузка геометрии Мира Б в фоне за 10-15 минут до смены фазы.