---
type: mechanic
system: quest_system
tags: [contracts, dynamic_objectives, colonization]
related_systems:
  - System_Dual_State_POIs
  - Mechanic_Hub_Map_Interaction
  - System_Reputation_Rules
---

# Движок Квестов (Quest Engine)

## 1. Философия: От Хаоса к Порядку
В Элдрейне квесты обслуживают процесс **Заселения (Settlement)**.
Аномалия не просто разрушает — она меняет реальность, "принося" из небытия новые здания, ресурсы и возможности.
* **Логика мира:** Сначала Аномалия создает "Потенциальную Точку" (Пустой магазин, Заброшенный склад). Затем Игрок в ходе рейда подготавливает почву. И только потом, в фазе Покоя, туда приходит NPC и открывает бизнес.

### Цикл Контракта
1.  **Появление (Anomaly Phase):** Генератор создает сектор. В нем появляются процедурные объекты с тегами `POTENTIAL_SHOP`, `ABANDONED_WORKSHOP`.
2.  **Заказ (Hub Phase):** NPC-Торговцы в Хабе видят эти новые возможности на карте (через данные разведки) и выдают контракты на их освоение.
3.  **Исполнение (Raid Phase):** Игрок высаживается в шторм, находит указанное здание и выполняет условия "Подготовки" (Зачистка, Включение генератора, Установка маяка).
4.  **Заселение (Next Hub Phase):** Если контракт выполнен, в следующей мирной фазе в этом здании появляется активный Торговец или Сервис.

---

## 2. Типология Контрактов

### A. "Риелтор" (Claiming & Securing)
Основной тип квестов, превращающий процедурные "коробки" в полезные сервисы.
* **Контекст:** "В Секторе 4 появился отлично сохранившийся Химзавод. Я хочу открыть там лабораторию."
* **Задача:**
    1. Найти здание по координатам (внутри полно монстров и лута).
    2. Зачистить периметр (Kill Quest).
    3. Установить **Право Собственности** (поставить цифровой маяк Гильдии).
* **Награда:** В мирное время этот NPC откроет там филиал и даст игроку скидку.

### B. "Первичный Капитал" (Seed Capital)
Квесты на наполнение будущей лавки товаром.
* **Контекст:** Лавка пуста. Чтобы Травник начал торговать, ему нужны исходники, которые есть *только* в самой Аномалии.
* **Задача:** "Принеси мне 5 ящиков *Мерцающего Мха* из зоны шторма. Тогда я смогу открыть лавку в мирное время."
* **Связь с лутом:** Игрок лутает саму лавку (во время Аномалии) и продает этот лут владельцу (чтобы тот продал его другим игрокам в мирное время).

### C. "Техническое Обслуживание" (Maintenance)
Для объектов, которые уже были заселены, но снова попали под удар Аномалии.
* **Контекст:** "Мою мастерскую снова накрыло штормом. Оборудование выдержит, но охранная турель обесточена."
* **Задача:** Пробиться к *уже известной* точке и заменить энергоячейку, пока мародеры не разнесли всё внутри.

---

## 3. Процедурная Генерация Задач
Движок анализирует метаданные свежесгенерированного мира (`Tech_POI_Metadata_Registry`) и создает "Очередь Возможностей".

### Алгоритм "Мэтчинга" (Opportunity Matching)
1.  **Input:** Генератор сообщает: *"В Промзоне создан объект `PREFAB_BAR_01` с тегом `EMPTY_COMMERCIAL`"*.
2.  **Processing:** Движок ищет свободных NPC из пула "Бродячих Торговцев".
    * *Например:* Бармен "Старина Джо" ищет место.
3.  **Output:** В Хабе появляется квест от Джо: *"Слушай, там в Промзоне видели отличную стойку. Если выбьешь оттуда рейдеров, я налью тебе бесплатно."*