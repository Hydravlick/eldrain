---
type: mechanic
system: trade_craft
tags: [merchant, stock, rng, rotation]
related_files:
  - "[[Lang_RU/00_Variables/Registry_Items|Registry_Items]]"
---

# Торговля: Генерация Ассортимента (Stock Gen)

## 1. Структура Торговца
Каждый NPC-торговец имеет профиль:
* `Fixed_Stock`: Товары, которые есть всегда (расходники, патроны). Бесконечное кол-во.
* `Rotating_Stock`: Товары, которые меняются по таймеру. Ограниченное кол-во.

## 2. Алгоритм Ротации (Refresh Cycle)
Раз в X часов (глобальный таймер сервера):
1.  Очищается список `Rotating_Stock`.
2.  Из `Registry_Items` выбираются предметы, соответствующие тегам торговца (например, `Tag: Weapon`, `Tag: Industrial`).
3.  Фильтрация по уровню репутации игрока (см. `FACT_02`).
4.  Генерация случайного количества (Stock Count).

## 3. Персонализация (Personal Stock)
Ассортимент генерируется **индивидуально** для каждого игрока (Instance).
* Это предотвращает ситуацию, когда боты скупают весь дефицитный товар на сервере.
* *Исключение:* Уникальные глобальные товары Черного Рынка (один на весь сервер), если таковые будут.