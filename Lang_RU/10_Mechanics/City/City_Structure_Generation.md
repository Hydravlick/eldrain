---
type: mechanic
system: city
tags:
  - generation
  - map_update
  - roguelite
  - hex_grid
related_mechanics:
  - "[[Anomaly_System]]"
  - "[[City_Structure]]"
---

# Генерация Структуры Города

## 1. Принцип Изменчивости
Якорь удерживает общую форму города, но детали постоянно меняются под воздействием Аномалий. Карта не статична.

---

## 2. Гексагональная Сетка (The Grid)
Город построен не по квартальной, а по гексагональной сетке, что обеспечивает более органичную и непредсказуемую структуру улиц.
* **Ячейка:** 1 Гекс = Базовая единица пространства.
* **Структура:** Здания могут занимать 1, 3 или 7 гексов (Multi-hex structures).
* **Дороги:** Процедурно соединяют точки привязки (Snap Points) между гексами, создавая запутанные лабиринты.

---

## 3. Генерация через Теги (Tag Logic)
Здания не выбираются из списка готовых пресетов, а собираются процедурно на основе **"Тегов Мебели"**.
* **Принцип:** Система сначала выбирает Теги (функцию), а потом подбирает под них Здание (форму).
    * *Логика 1:* `[Tag: Med_Bed]` + `[Tag: Equipment]` → Генератор создает "Полевой Госпиталь".
    * *Логика 2:* `[Tag: Safe]` + `[Tag: Weapon_Rack]` → Генератор создает "Укрепленный Блокпост".

---

## 4. Распределение Построек (Spawn Rates)
При генерации квартала система соблюдает баланс контента, чтобы игрок всегда находил интересные точки.

| Тип Здания | Шанс | Описание |
| :--- | :--- | :--- |
| **Обычные** | 55% | Жилые дома, руины. Лут: Мусор, Ресурсы крафта. |
| **Квестовые** | 23% | Здания с записками, следами, сюжетными NPC. |
| **Уникальные** | 22% | Банки, Оружейные, Лаборатории. Лут: Артефакты. |

---

## 5. Градация Изменений (Map Update Tiers)

### Точечное Изменение (Minor Shift)
* **Частота:** Каждый рейд.
* **Суть:** Замена отдельных зданий или комнат. Дверь, которая была открыта вчера, сегодня замурована. Появилась новая лестница.
* **Влияние:** Ломает привычные маршруты ("спидраннеры" страдают).

### Частичное Изменение (Major Shift)
* **Частота:** Раз в неделю (или по таймеру события).
* **Суть:** Обновление целого квартала. Меняется геометрия улиц, расположение укрытий и точек спавна лута.
* **Влияние:** Требует новой разведки. Старые карты становятся неточными.

### Полное Изменение (Global Reset)
* **Частота:** Глобальный Вайп (Сезон).
* **Суть:** Полная перестройка района. Тема остается (Порт все еще Порт), но ландшафт абсолютно новый.

---

## 6. Алгоритм Ротации (District Cycle)
Как именно система решает, что и когда менять.
* **Пул:** 10 Кварталов всего (6 Активных на карте + 4 в "Резерве" Аномалии).
* **Триггер Замены:** Истощение ресурсов (кол-во успешных вылазок игроков в этот район).
* **Коэффициенты Обновления:**
    * **Коэф. Неизменности:** Чем дольше зона не менялась, тем выше шанс *Полного Изменения* (замена всего квартала на резервный).
    * **Коэф. Присутствия:** Чем дольше уникальное здание не спавнилось, тем выше шанс его появления при *Точечном Изменении*.